# default.conf —— 只放 server 块
server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # ✨ 关键补丁：在 server 内定义常用类型（覆盖上层缺失 mime.types 的问题）
  types {
    text/html                              html htm;
    text/css                               css;
    application/javascript                 js mjs;
    application/json                       json;
    image/svg+xml                          svg;
    image/png                              png;
    image/jpeg                             jpg jpeg;
    font/woff2                             woff2;
    video/mp4                              mp4;
    video/webm                             webm;
  }
  default_type text/html;  # 默认按 HTML 处理（兜底，静态文件仍会按上面 types 匹配）

  # SPA 路由
  location / { try_files $uri $uri/ /index.html; }

  # 视频（支持拖动/分段）
  location ~* \.(mp4|webm)$ {
    mp4;
    add_header Accept-Ranges bytes;
    add_header Cache-Control "public, max-age=604800";
  }

  # 静态资源缓存
  location ~* \.(?:js|css|png|jpg|jpeg|svg|ico|woff2?)$ {
    expires 30d;
    access_log off;
    add_header Cache-Control "public, max-age=2592000, immutable";
  }
}
